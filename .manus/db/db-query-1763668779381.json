{
  "query": "-- Criar tabela de planos\nCREATE TABLE IF NOT EXISTS planos (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  box_id INT NOT NULL,\n  nome VARCHAR(100) NOT NULL,\n  descricao TEXT,\n  preco DECIMAL(10, 2) NOT NULL,\n  duracao_dias INT NOT NULL DEFAULT 30,\n  limite_checkins INT DEFAULT NULL,\n  ativo BOOLEAN DEFAULT TRUE,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  INDEX idx_box_id (box_id),\n  INDEX idx_ativo (ativo)\n);\n\n-- Criar tabela de assinaturas\nCREATE TABLE IF NOT EXISTS assinaturas (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  plano_id INT NOT NULL,\n  data_inicio DATE NOT NULL,\n  data_vencimento DATE NOT NULL,\n  status ENUM('ativa', 'vencida', 'cancelada') DEFAULT 'ativa',\n  renovacao_automatica BOOLEAN DEFAULT FALSE,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  INDEX idx_user_id (user_id),\n  INDEX idx_plano_id (plano_id),\n  INDEX idx_status (status),\n  INDEX idx_data_vencimento (data_vencimento),\n  FOREIGN KEY (plano_id) REFERENCES planos(id) ON DELETE RESTRICT\n);\n\n-- Criar tabela de histórico de pagamentos\nCREATE TABLE IF NOT EXISTS historico_pagamentos (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  assinatura_id INT NOT NULL,\n  user_id INT NOT NULL,\n  valor DECIMAL(10, 2) NOT NULL,\n  data_pagamento TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  metodo_pagamento VARCHAR(50),\n  status ENUM('pendente', 'pago', 'cancelado') DEFAULT 'pendente',\n  observacoes TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  INDEX idx_assinatura_id (assinatura_id),\n  INDEX idx_user_id (user_id),\n  INDEX idx_status (status),\n  INDEX idx_data_pagamento (data_pagamento),\n  FOREIGN KEY (assinatura_id) REFERENCES assinaturas(id) ON DELETE CASCADE\n);\n\n-- Adicionar campos de assinatura na tabela users\nALTER TABLE users \nADD COLUMN IF NOT EXISTS plano_id INT DEFAULT NULL,\nADD COLUMN IF NOT EXISTS data_vencimento DATE DEFAULT NULL,\nADD COLUMN IF NOT EXISTS status_assinatura ENUM('ativa', 'vencida', 'trial', 'cancelada') DEFAULT 'trial';\n\n-- Criar índices para melhor performance\nCREATE INDEX IF NOT EXISTS idx_users_plano_id ON users(plano_id);\nCREATE INDEX IF NOT EXISTS idx_users_data_vencimento ON users(data_vencimento);\nCREATE INDEX IF NOT EXISTS idx_users_status_assinatura ON users(status_assinatura);",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user njLUTjzwczDK38t.a52c1e22817e --database WZEKsstKXPtdSNXaJtxfch --execute -- Criar tabela de planos\nCREATE TABLE IF NOT EXISTS planos (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  box_id INT NOT NULL,\n  nome VARCHAR(100) NOT NULL,\n  descricao TEXT,\n  preco DECIMAL(10, 2) NOT NULL,\n  duracao_dias INT NOT NULL DEFAULT 30,\n  limite_checkins INT DEFAULT NULL,\n  ativo BOOLEAN DEFAULT TRUE,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  INDEX idx_box_id (box_id),\n  INDEX idx_ativo (ativo)\n);\n\n-- Criar tabela de assinaturas\nCREATE TABLE IF NOT EXISTS assinaturas (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  plano_id INT NOT NULL,\n  data_inicio DATE NOT NULL,\n  data_vencimento DATE NOT NULL,\n  status ENUM('ativa', 'vencida', 'cancelada') DEFAULT 'ativa',\n  renovacao_automatica BOOLEAN DEFAULT FALSE,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  INDEX idx_user_id (user_id),\n  INDEX idx_plano_id (plano_id),\n  INDEX idx_status (status),\n  INDEX idx_data_vencimento (data_vencimento),\n  FOREIGN KEY (plano_id) REFERENCES planos(id) ON DELETE RESTRICT\n);\n\n-- Criar tabela de histórico de pagamentos\nCREATE TABLE IF NOT EXISTS historico_pagamentos (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  assinatura_id INT NOT NULL,\n  user_id INT NOT NULL,\n  valor DECIMAL(10, 2) NOT NULL,\n  data_pagamento TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  metodo_pagamento VARCHAR(50),\n  status ENUM('pendente', 'pago', 'cancelado') DEFAULT 'pendente',\n  observacoes TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  INDEX idx_assinatura_id (assinatura_id),\n  INDEX idx_user_id (user_id),\n  INDEX idx_status (status),\n  INDEX idx_data_pagamento (data_pagamento),\n  FOREIGN KEY (assinatura_id) REFERENCES assinaturas(id) ON DELETE CASCADE\n);\n\n-- Adicionar campos de assinatura na tabela users\nALTER TABLE users \nADD COLUMN IF NOT EXISTS plano_id INT DEFAULT NULL,\nADD COLUMN IF NOT EXISTS data_vencimento DATE DEFAULT NULL,\nADD COLUMN IF NOT EXISTS status_assinatura ENUM('ativa', 'vencida', 'trial', 'cancelada') DEFAULT 'trial';\n\n-- Criar índices para melhor performance\nCREATE INDEX IF NOT EXISTS idx_users_plano_id ON users(plano_id);\nCREATE INDEX IF NOT EXISTS idx_users_data_vencimento ON users(data_vencimento);\nCREATE INDEX IF NOT EXISTS idx_users_status_assinatura ON users(status_assinatura);",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 4603
}